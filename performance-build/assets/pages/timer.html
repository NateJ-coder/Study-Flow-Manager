<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="StudyFlow Manager - Pomodoro Timer">
  <title>StudyFlow Timer</title>
  
  <!-- External CSS -->
  <link rel="stylesheet" href="/Study-Flow-Manager/performance-build/assets/css/timer.css?v=2025101401">
  <!-- Defer decorative particles CSS to avoid blocking first paint -->
  <link rel="preload" href="/Study-Flow-Manager/performance-build/assets/css/particles.css?v=2025101501" as="style">
  <link rel="stylesheet" href="/Study-Flow-Manager/performance-build/assets/css/particles.css?v=2025101501" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="/Study-Flow-Manager/performance-build/assets/css/particles.css?v=2025101501"></noscript>
  <!-- Central config -->
  <script src="/Study-Flow-Manager/performance-build/assets/js/config.js" defer></script>

  <!-- Preconnect to Firebase/CDN hosts to speed up dynamic imports -->
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin>

  <!-- Preload a best-guess first background image for LCP (based on stored theme + day/night) -->
  <link rel="modulepreload" href="/Study-Flow-Manager/performance-build/assets/js/timer.js?v=2025101401">
  <script>
  (function(){
    try {
      const BASE = '/Study-Flow-Manager/performance-build/assets';
      const hour = new Date().getHours();
      const night = (hour >= 18 || hour < 6);
      const theme = (localStorage.getItem('sf_theme') || 'autumn');
      const first = `${BASE}/images/${theme}-${night ? 'night' : 'day'}-1.png`;
      const l = document.createElement('link');
      l.rel = 'preload'; l.as = 'image'; l.href = first; l.fetchPriority = 'high';
      document.head.appendChild(l);

      // Immediately set the background image src so first paint shows it
      const setFirst = () => {
        try {
          const img = document.getElementById('background-image');
          if (img) img.src = first;
        } catch (e) { /* non-blocking */ }
      };
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setFirst, { once: true });
      } else {
        setFirst();
      }

    } catch(e) { /* non-blocking */ }
  })();
  </script>
  <!-- Early preference read to avoid flash-of-glow on cold load -->
  <script>
    try {
      var _pref = localStorage.getItem('sf_disable_ticking_glow');
      if (_pref === '1') {
        // add class to root element as early as possible to prevent paint flash
        document.documentElement.classList.add('no-ticking-glow');
      }
    } catch (e) { /* ignore */ }
  </script>

</head>
<body>

  <!-- Loading Overlay -->
  <div id="loading-overlay">Initializing StudyFlow...</div>

  <!-- Background Layer -->
  <div id="bg-container">
    <img id="background-image" src="" alt="Dynamic StudyFlow Background" decoding="async" fetchpriority="high" />
  </div>
  
  <!-- Particle Layer -->
  <canvas id="particle-canvas" aria-hidden="true"></canvas>
  
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="studyflow-logo">StudyFlow</div>
      <a href="https://www.youtube.com/live/jfKfPfyJRdk?si=WXDVOI2ouHrBMAcu" 
         target="_blank" 
         class="flow-link"
         title="Find your flow">
        <span class="headphones-icon">üéß</span>
      </a>
    </div>
    <div class="clock-container">
      <!-- Clock Icon SVG -->
      <svg class="clock-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.58 20 4 16.42 4 12C4 7.58 7.58 4 12 4C16.42 4 20 7.58 20 12C20 16.42 16.42 20 12 20ZM12.5 7H11V13L16.2 16.1L16.9 14.9L12.5 12.3V7Z" fill="currentColor"/>
      </svg>
      <div id="perpetual-clock">00:00:00</div>
    </div>
  </header>

  <!-- Main Content Container -->
  <div class="container">
    <div class="timer-card">
      <button class="back-btn" onclick="window.location.href='/Study-Flow-Manager/index.html'">
        &larr; Back
      </button>

      <!-- Calendar Icon SVG -->
      <svg class="card-icon calendar-icon" onclick="showCalendarModal()" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 4H18V2H16V4H8V2H6V4H5C3.89 4 3 4.9 3 6V20C3 21.1 3.89 22 5 22H19C20.1 22 21 21.1 21 20V6C21 4.9 20.1 4 19 4ZM19 20H5V10H19V20ZM19 8H5V6H19V8Z" fill="currentColor"/>
      </svg>
      
      <!-- Settings Icon SVG -->
      <svg class="card-icon settings-icon" id="settingsButton" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19.4 12.98C19.4 12.56 19.44 12.28 19.44 12C19.44 11.72 19.4 11.44 19.4 11.02L21.54 9.38C21.73 9.24 21.77 8.97 21.66 8.76L19.5 5.14C19.39 4.94 19.1 4.88 18.89 4.97L16.41 5.95C15.84 5.48 15.22 5.06 14.54 4.74L14.15 2.21C14.11 1.95 13.88 1.76 13.61 1.76H10.39C10.12 1.76 9.89 1.95 9.85 2.21L9.46 4.74C8.78 5.06 8.16 5.48 7.59 5.95L5.11 4.97C4.9 4.88 4.61 4.94 4.5 5.14L2.34 8.76C2.23 8.97 2.27 9.24 2.46 9.38L4.6 11.02C4.6 11.44 4.56 11.72 4.56 12C4.56 12.28 4.6 12.56 4.6 12.98L2.46 14.62C2.27 14.76 2.23 15.03 2.34 15.24L4.5 18.86C4.61 19.06 4.9 19.12 5.11 19.03L7.59 18.05C8.16 18.52 8.78 18.94 9.46 19.26L9.85 21.79C9.89 22.05 10.12 22.24 10.39 22.24H13.61C13.88 22.24 14.11 22.05 14.15 21.79L14.54 19.26C15.22 18.94 15.84 18.52 16.41 18.05L18.89 19.03C19.1 19.12 19.39 19.06 19.5 18.86L21.66 15.24C21.77 15.03 21.73 14.76 21.54 14.62L19.4 12.98ZM12 16C9.79 16 8 14.21 8 12C8 9.79 9.79 8 12 8C14.21 8 16 9.79 16 12C16 14.21 14.21 16 12 16Z" fill="currentColor"/>
      </svg>

      <div id="timer-mode" class="timer-mode">Focus Session</div>
      <div id="timer-display" class="timer-display">25:00</div>
      
      <div class="timer-controls">
        <button id="startButton" class="control-btn wood-btn">Start</button>
        <button id="resetButton" class="control-btn wood-btn" disabled>Reset</button>
      </div>

      <p class="session-counter" id="session-counter">Session 1 of 4</p>
      <p class="session-info" id="session-info">Time to dive into deep work. Good luck!</p>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="settings-modal" id="settingsModal">
    <h2>Settings</h2>
    
    <div class="setting-group">
      <label for="theme-select">Seasonal Theme</label>
      <select id="theme-select">
        <option value="autumn">Autumn üçÇ</option>
        <option value="winter">Winter ‚ùÑÔ∏è</option>
        <option value="summer">Summer ‚òÄÔ∏è</option>
      </select>
    </div>

    <div class="setting-group">
      <label for="focus-duration">Focus Duration (min)</label>
      <select id="focus-duration">
        <option value="15">15</option>
        <option value="25">25</option>
        <option value="30">30</option>
        <option value="45">45</option>
        <option value="60">60</option>
      </select>
    </div>

    <div class="setting-group">
      <label for="short-break-duration">Short Break (min)</label>
      <select id="short-break-duration">
        <option value="3">3</option>
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="15">15</option>
      </select>
    </div>

    <div class="setting-group">
      <label for="long-break-duration">Long Break (min)</label>
      <select id="long-break-duration">
        <option value="15">15</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="45">45</option>
      </select>
    </div>

    <div class="setting-group">
      <label for="sessions-before-long-break">Sessions until Long Break</label>
      <select id="sessions-before-long-break">
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
      </select>
    </div>

    <div class="setting-group">
      <label for="slideshow-interval">Background Slideshow</label>
      <select id="slideshow-interval">
        <!-- Options dynamically populated based on image preload performance -->
      </select>
    </div>

    <div class="setting-group">
      <label for="sleep-timeout">Sleep Mode Timeout</label>
      <select id="sleep-timeout">
        <option value="5">5 seconds (test)</option>
        <option value="60">1 minute</option>
        <option value="120">2 minutes</option>
        <option value="300">5 minutes</option>
        <option value="600">10 minutes</option>
        <option value="900">15 minutes</option>
        <option value="1800">30 minutes</option>
        <option value="0">Never</option>
      </select>
    </div>
    
    <!-- New setting: Disable ticking glow for accessibility or preference -->
    <div class="setting-group">
      <label for="disable-ticking-glow">Disable ticking glow</label>
      <input type="checkbox" id="disable-ticking-glow" />
    </div>

    <!-- Placeholder for other settings like audio volume -->
  <div class="settings-actions">
    <button type="button" class="settings-save-btn" id="settingsSaveBtn">Save</button>
    <button type="button" class="settings-close-btn">Close</button>
  </div>
  </div>

  <!-- Particle System -->
  <script src="/Study-Flow-Manager/performance-build/assets/js/particle.js?v=2025101401"></script>
  
  <!-- Sleep Mode System (quotes will be loaded dynamically by sleep.js when sleep starts) -->
  <script src="/Study-Flow-Manager/performance-build/assets/js/sleep.js?v=2025101401"></script>
  
  <!-- Overlay fade is handled by showAppWhenReady() in timer.js to avoid racing with BG load -->

  <!-- Firebase and Core Logic -->
  <script type="module" src="/Study-Flow-Manager/performance-build/assets/js/timer.js?v=2025101401"></script>
</body>
</html>