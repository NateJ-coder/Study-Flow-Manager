<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="StudyFlow Manager - Welcome">
  
  <!-- Performance-Critical Preloads -->
  <link rel="preload" href="assets/images/welcome-page.png" as="image" fetchpriority="high">
  <link rel="preload" href="assets/css/core.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="assets/css/core.css"></noscript>
  <link rel="preload" href="assets/js/settings.js" as="script">
  
  <!-- No external CSS dependencies - all critical CSS is inline -->
  
  <!-- Critical CSS Inline -->
  <style>
    /* Using system fonts for better performance */
    
    :root {
      --primary-bg: #0f1419;
      --text-color: #e7eaee;
      --accent-color: #64ffda;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--primary-bg);
      color: var(--text-color);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* Custom animations for lo-fi feel */
    @keyframes pulse-slow {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    @keyframes bounce-slow {
      0%, 100% { transform: translateY(0); }  
      50% { transform: translateY(-5%); }
    }
    
    .animate-pulse-slow {
      animation: pulse-slow 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    .animate-bounce-slow {
      animation: bounce-slow 3s ease-in-out infinite;
    }
    
    /* Critical utility classes */
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .text-center { text-align: center; }
    .hidden { display: none !important; }
    .mb-10 { margin-bottom: 2.5rem; }
    .mt-4 { margin-top: 1rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mt-12 { margin-top: 3rem; }
    .p-6 { padding: 1.5rem; }
    .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
    .px-10 { padding-left: 2.5rem; padding-right: 2.5rem; }
    .rounded-xl { border-radius: 0.75rem; }
    .font-black { font-weight: 900; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .font-medium { font-weight: 500; }
    .text-6xl { font-size: 3.75rem; line-height: 1; }
    .text-8xl { font-size: 6rem; line-height: 1; }
    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-amber-300 { color: #fcd34d; }
    .text-amber-500 { color: #f59e0b; }
    .text-white { color: #ffffff; }
    .bg-amber-600 { background-color: rgba(217, 119, 6, 0.7); }
    .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
    .transition { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
    .duration-200 { transition-duration: 200ms; }
    .border-b-4 { border-bottom-width: 4px; }
    .border-r-2 { border-right-width: 2px; }
    .border-amber-800 { border-color: rgba(146, 64, 14, 0.8); }
    .cursor-pointer { cursor: pointer; }
    .opacity-90 { opacity: 0.9; }
    .opacity-70 { opacity: 0.7; }
    .inline-block { display: inline-block; }
    .w-full { width: 100%; }
    .h-full { height: 100%; }
    .max-w-4xl { max-width: 56rem; }
    .backdrop-blur-sm { backdrop-filter: blur(4px); }
    .bg-black { background-color: rgba(0, 0, 0, 0.4); }
    .rounded-3xl { border-radius: 1.5rem; }
    .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
    
    /* Hover states */
    .hover\:bg-amber-500:hover { background-color: rgba(245, 158, 11, 0.8); }
    .active\:scale-\[0\.98\]:active { transform: scale(0.98); }
    .hover\:scale-\[1\.02\]:hover { transform: scale(1.02); }
    
    /* Responsive */
    @media (min-width: 768px) {
      .md\:text-8xl { font-size: 6rem; line-height: 1; }
      .md\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
      .md\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
      .md\:p-12 { padding: 3rem; }
    }    /* Loading spinner */
    .loading-spinner {
      width: 64px;
      height: 64px;
      border: 4px solid rgba(251, 191, 36, 0.3);
      border-top: 4px solid rgba(251, 191, 36, 0.8);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Page transitions */
    .page-container {
      transition: all 0.5s ease-in-out;
    }
    
    .page-hidden {
      opacity: 0;
      transform: scale(0.95);
    }
    
    .page-visible {
      opacity: 1;
      transform: scale(1);
    }
    
    /* Critical utility classes to replace Tailwind */
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .text-center { text-align: center; }
    .hidden { display: none !important; }
    .mb-10 { margin-bottom: 2.5rem; }
    .mt-4 { margin-top: 1rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mt-12 { margin-top: 3rem; }
    .p-6 { padding: 1.5rem; }
    .p-8 { padding: 2rem; }
    .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
    .px-10 { padding-left: 2.5rem; padding-right: 2.5rem; }
    .rounded-xl { border-radius: 0.75rem; }
    .rounded-3xl { border-radius: 1.5rem; }
    .font-black { font-weight: 900; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .font-medium { font-weight: 500; }
    .font-inter { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; }
    .text-6xl { font-size: 3.75rem; line-height: 1; }
    .text-8xl { font-size: 6rem; line-height: 1; }
    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
    .text-2xl { font-size: 1.5rem; line-height: 2rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-xs { font-size: 0.75rem; line-height: 1rem; }
    .text-5xl { font-size: 3rem; line-height: 1; }
    .text-amber-300 { color: #fcd34d; }
    .text-amber-500 { color: #f59e0b; }
    .text-white { color: #ffffff; }
    .text-indigo-500 { color: #6366f1; }
    .text-green-500 { color: #10b981; }
    .text-red-500 { color: #ef4444; }
    .bg-amber-600 { background-color: rgba(217, 119, 6, 0.7); }
    .bg-indigo-500 { background-color: #6366f1; }
    .bg-green-500 { background-color: #10b981; }
    .bg-red-500 { background-color: #ef4444; }
    .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
    .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
    .transition { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
    .duration-200 { transition-duration: 200ms; }
    .border-b-4 { border-bottom-width: 4px; }
    .border-r-2 { border-right-width: 2px; }
    .border-amber-800 { border-color: rgba(146, 64, 14, 0.8); }
    .cursor-pointer { cursor: pointer; }
    .opacity-90 { opacity: 0.9; }
    .opacity-70 { opacity: 0.7; }
    .inline-block { display: inline-block; }
    .w-full { width: 100%; }
    .h-full { height: 100%; }
    .max-w-4xl { max-width: 56rem; }
    .backdrop-blur-sm { backdrop-filter: blur(4px); }
    .bg-black { background-color: rgba(0, 0, 0, 0.4); }
    .space-x-4 > * + * { margin-left: 1rem; }
    .mb-8 { margin-bottom: 2rem; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
    .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .rounded-lg { border-radius: 0.5rem; }
    .absolute { position: absolute; }
    .bottom-4 { bottom: 1rem; }
    .right-4 { right: 1rem; }
    .relative { position: relative; }
    .z-10 { z-index: 10; }
    .fixed { position: fixed; }
    .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
    .bg-cover { background-size: cover; }
    .bg-center { background-position: center; }
    .min-h-screen { min-height: 100vh; }
    .bg-gray-900 { background-color: #111827; }
    .antialiased { -webkit-font-smoothing: antialiased; }
    .overflow-hidden { overflow: hidden; }
    
    /* Hover states */
    .hover-bg-amber-500:hover { background-color: rgba(245, 158, 11, 0.8); }
    .hover-bg-indigo-600:hover { background-color: #4f46e5; }
    .hover-bg-green-600:hover { background-color: #059669; }
    .hover-bg-red-600:hover { background-color: #dc2626; }
    .active-scale-98:active { transform: scale(0.98); }
    .hover-scale-102:hover { transform: scale(1.02); }
    
    /* Responsive */
    @media (min-width: 768px) {
      .md\\:text-8xl { font-size: 6rem; line-height: 1; }
      .md\\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
      .md\\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
      .md\\:p-12 { padding: 3rem; }
    }
  </style>
  
  <title>StudyFlow Manager - Welcome</title>
</head>
<body class="min-h-screen bg-gray-900 font-inter antialiased overflow-hidden">
  <!-- Background Container -->
  <div 
    id="background-container"
    class="fixed inset-0 bg-cover bg-center transition-opacity duration-1000 ease-in-out"
    style="
      background-image: url('assets/images/welcome-page.png');
      filter: brightness(0.7) blur(1px);
      z-index: 0;
    "
  ></div>
  
  <!-- Content Area -->
  <div class="relative z-10 min-h-screen flex flex-col justify-center items-center">
    <div 
      id="content-container"
      class="w-full max-w-4xl p-8 md:p-12 backdrop-blur-sm bg-black/40 rounded-3xl shadow-2xl page-container page-visible"
      style="min-height: 70vh;"
    >
      <!-- Welcome Screen -->
      <div id="welcome-screen" class="flex flex-col items-center justify-center h-full w-full p-6">
        <header class="mb-10 text-center">
          <h1 
            class="text-6xl md:text-8xl font-black text-amber-300 animate-bounce-slow"
            style="text-shadow: 4px 4px 8px rgba(0,0,0,0.3);"
          >
            StudyFlow
          </h1>
          <p class="text-xl md:text-2xl mt-4 font-semibold text-amber-500 opacity-90">
            Lofi focus for high-tier productivity.
          </p>
        </header>

        <main class="text-center">
          <div id="loading-state" class="flex flex-col items-center">
            <div class="loading-spinner mb-4"></div>
            <p class="text-lg text-amber-300 font-medium">
              Loading the perfect vibe...
            </p>
          </div>
          
          <button 
            id="continue-button"
            class="hidden bg-amber-600 text-white font-inter font-bold py-4 px-10 rounded-xl shadow-xl transition duration-200 hover-bg-amber-500 active-scale-98 hover-scale-102 cursor-pointer border-b-4 border-r-2 border-amber-800 text-lg md:text-xl"
            onclick="continueToApp()"
          >
            Continue to Focus
          </button>
        </main>

        <footer class="mt-12 opacity-70">
          <p class="text-white text-sm">
            <span class="inline-block animate-pulse-slow">🎧</span> 
            <a href="https://www.youtube.com/live/jfKfPfyJRdk?si=WXDVOI2ouHrBMAcu" 
               target="_blank" 
               style="color: inherit; text-decoration: none; cursor: pointer;"
               onclick="playSound('click')"
               onmouseover="this.style.textDecoration='underline'"
               onmouseout="this.style.textDecoration='none'">
              Time to find your flow.
            </a>
          </p>
        </footer>
      </div>

      <!-- Timer Page (Hidden initially) -->
      <div id="timer-screen" class="hidden flex flex-col items-center justify-center h-full w-full p-6 text-white">
        <h2 class="text-5xl font-bold text-amber-300 mb-8">
          ⏰ Pomodoro Timer
        </h2>
        <div class="text-2xl mb-8">
          Ready to focus! (Timer functionality coming soon)
        </div>
        <div class="flex space-x-4">
          <button 
            onclick="goToCalendar()"
            class="px-6 py-3 bg-indigo-500 rounded-lg hover-bg-indigo-600 transition duration-200"
          >
            📅 Go to Calendar
          </button>
          <button 
            onclick="goToWelcome()"
            class="px-6 py-3 bg-red-500 rounded-lg hover-bg-red-600 transition duration-200"
          >
            Go Back
          </button>
        </div>
      </div>

      <!-- Calendar Page (Hidden initially) -->
      <div id="calendar-screen" class="hidden flex flex-col items-center justify-center h-full w-full p-6 text-white">
        <h2 class="text-5xl font-bold text-amber-300 mb-8">
          📅 Flow Calendar
        </h2>
        <div class="text-2xl mb-8">
          Visualize your focus blocks here.
        </div>
        <div class="flex space-x-4">
          <button 
            onclick="goToTimer()"
            class="px-6 py-3 bg-green-500 rounded-lg hover-bg-green-600 transition duration-200"
          >
            ⏰ Go to Timer
          </button>
          <button 
            onclick="goToWelcome()"
            class="px-6 py-3 bg-red-500 rounded-lg hover-bg-red-600 transition duration-200"
          >
            Go Back
          </button>
        </div>
      </div>
    </div>

    <!-- Debug Info -->
    <div class="absolute bottom-4 right-4 text-xs text-white/50" id="debug-info">
      Status: Loading assets...
    </div>
  </div>

  <script>
    // ============================================
    // STUDYFLOW WELCOME PAGE APPLICATION
    // ============================================

    // Page States
    const PAGE_STATE = {
      WELCOME: 'welcome',
      TIMER: 'timer',
      CALENDAR: 'calendar'
    };

    // Theme Configuration (matches your existing structure)
    const THEME_DATA = {
      AUTUMN: {
        name: 'Autumn Flow',
        bg_day: 'assets/images/autumn-day-8.png',
        bg_night: 'assets/images/autumn-night-1.png',
        primary_color: 'text-amber-300',
        secondary_color: 'text-amber-500',
        button_bg: 'bg-amber-600/70',
        button_hover: 'hover:bg-amber-500/80'
      }
    };

    // Application State
    let currentPage = PAGE_STATE.WELCOME;
    let currentTheme = 'AUTUMN';
    let isLoaded = false;
    let isAuthReady = false;

    // PERFORMANCE OPTIMIZED: Only preload critical assets for LCP
    const CRITICAL_ASSETS = [
      'assets/images/welcome-page.png', // Dedicated welcome background
      'assets/audio/click.mp3',
      'assets/audio/splash.mp3'
    ];
    
    // Background images for lazy loading (loaded by settings.js as needed)
    const BACKGROUND_IMAGES = [
      'assets/images/autumn-day-1.png',
      'assets/images/autumn-day-2.png',
      'assets/images/autumn-day-3.png',
      'assets/images/autumn-day-4.png',
      'assets/images/autumn-day-5.png',
      'assets/images/autumn-day-6.png',
      'assets/images/autumn-day-7.png',
      'assets/images/autumn-day-8.png',
      'assets/images/autumn-night-1.png',
      'assets/images/autumn-night-2.png',
      'assets/images/autumn-night-3.png',
      'assets/images/summer-day-1.png',
      'assets/images/winter-day-1.png'
    ];

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================

    // Preload images for performance
    function preloadImages(urls) {
      return Promise.all(urls.map(url => {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = () => resolve(url);
          img.onerror = () => {
            console.warn(`Failed to load: ${url}`);
            resolve(url); // Continue even if some images fail
          };
          img.src = url;
        });
      }));
    }

    // Update debug info
    function updateDebugInfo(message) {
      const debugElement = document.getElementById('debug-info');
      if (debugElement) {
        debugElement.textContent = message;
      }
    }

    // ============================================
    // PAGE NAVIGATION FUNCTIONS
    // ============================================

    function showPage(pageId) {
      // Hide all pages
      ['welcome-screen', 'timer-screen', 'calendar-screen'].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.classList.add('hidden');
        }
      });

      // Show target page
      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        targetPage.classList.remove('hidden');
      }

      // Update current page state
      currentPage = pageId.replace('-screen', '');
    }

    function continueToApp() {
      if (isLoaded) {
        playSound('click');
        window.location.href = 'timer.html';
      }
    }

    function goToTimer() {
      playSound('click');
      window.location.href = 'timer.html';
    }

    function goToCalendar() {
      playSound('click');
      window.location.href = 'calendar.html';
    }

    function goToWelcome() {
      showPage('welcome-screen');
      playSound('click');
      updateDebugInfo('Status: Welcome page');
    }

    // ============================================
    // AUDIO FUNCTIONS
    // ============================================

    function playSound(soundName) {
      try {
        const soundMap = {
          'click': 'assets/audio/click.mp3',
          'splash': 'assets/audio/splash.mp3'
        };
        
        if (soundMap[soundName]) {
          const audio = new Audio(soundMap[soundName]);
          audio.volume = 0.3;
          audio.play().catch(() => {
            // Ignore audio play errors (autoplay restrictions)
          });
        }
      } catch (error) {
        console.warn('Audio playback failed:', error);
      }
    }

    // ============================================
    // INITIALIZATION
    // ============================================

    document.addEventListener('DOMContentLoaded', async function() {
      updateDebugInfo('Status: Loading critical assets for LCP...');
      
      try {
        // PERFORMANCE OPTIMIZATION: Only preload critical assets for LCP
        console.log('🚀 LCP Optimization: Preloading', CRITICAL_ASSETS.length, 'critical assets...');
        
        await preloadImages(CRITICAL_ASSETS);
        
        console.log('✅ Critical assets loaded! LCP optimized.');
        updateDebugInfo('Status: Critical assets loaded, preparing app...');
        
        // Simulate auth ready (since we removed Firebase for now)
        isAuthReady = true;
        
        // Initialize background manager for intelligent preloading
        if (typeof BackgroundManager !== 'undefined') {
          window.backgroundManager = new BackgroundManager();
          window.backgroundManager.init();
        }
        
        // Keep loading state for smooth transition (reduced for LCP)
        setTimeout(() => {
          isLoaded = true;
          
          // Hide loading state and show continue button
          const loadingState = document.getElementById('loading-state');
          const continueButton = document.getElementById('continue-button');
          
          if (loadingState) loadingState.classList.add('hidden');
          if (continueButton) continueButton.classList.remove('hidden');
          
          updateDebugInfo('Status: Ready to continue! Background images loading lazily...');
          
          // Start lazy loading additional backgrounds after user interaction is ready
          setTimeout(() => {
            lazyLoadAdditionalBackgrounds();
          }, 2000);
          
        }, 800); // Reduced from 1500ms for faster LCP
        
      } catch (error) {
        console.error('Critical asset preloading failed:', error);
        updateDebugInfo('Status: Load failed, but you can continue');
        
        // Allow continuation even if preload fails
        setTimeout(() => {
          isLoaded = true;
          const loadingState = document.getElementById('loading-state');
          const continueButton = document.getElementById('continue-button');
          
          if (loadingState) loadingState.classList.add('hidden');
          if (continueButton) continueButton.classList.remove('hidden');
          
        }, 1000); // Faster fallback
      }
    });

    // ============================================
    // LAZY LOADING FOR NON-CRITICAL BACKGROUNDS
    // ============================================
    
    function lazyLoadAdditionalBackgrounds() {
      console.log('🖼️ Starting lazy load of additional backgrounds...');
      
      // Load one background every 3 seconds to avoid network congestion
      let index = 0;
      const loadNext = () => {
        if (index < BACKGROUND_IMAGES.length) {
          const img = BACKGROUND_IMAGES[index];
          if (img !== 'assets/images/autumn-day-8.png') { // Skip already loaded
            preloadImages([img]).then(() => {
              console.log(`📸 Lazy loaded: ${img.split('/').pop()}`);
            }).catch(() => {
              console.warn(`❌ Failed to lazy load: ${img}`);
            });
          }
          index++;
          setTimeout(loadNext, 3000); // 3 second delay between loads
        } else {
          console.log('✅ All background images loaded via lazy loading');
          updateDebugInfo('Status: All assets ready! Enjoy StudyFlow.');
        }
      };
      
      // Start lazy loading after a short delay
      setTimeout(loadNext, 1000);
    }

    // Add keyboard navigation
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && isLoaded && currentPage === 'welcome') {
        continueToApp();
      }
    });

    console.log('StudyFlow Welcome Page initialized successfully!');
  </script>
  
  <!-- Background Management (Intelligent Preloading) -->
  <script src="assets/js/settings.js" defer></script>
</body>
</html>